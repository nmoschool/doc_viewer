<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­) --- */
      :root {
        --primary-color: #007bff;
        --secondary-color: #1a73e8;
        --bg-color: #f4f7f6;
        --panel-bg: #ffffff;
        --border-color: #e0e4e7;
        --text-color: #333d47;
        --light-text: #707b85;
        --hover-bg: #f0f3f5;
        --shadow-elevation: 0 4px 12px rgba(0, 0, 0, 0.05);
        --icon-color-pdf: #e63946;
        --icon-color-doc: #2196f3;
        --icon-color-xls: #4caf50;
        --icon-color-ppt: #ff9800;
        --icon-color-img: #9c27b0;
        --icon-color-txt: #607d8b;
        --icon-color-html: #f36f21;
        --icon-color-audio: #8e44ad; /* Ø¬Ø¯ÙŠØ¯: Ø¯Ø¹Ù… ØµÙˆØªÙŠØ§Øª */
        --icon-color-video: #e74c3c; /* Ø¬Ø¯ÙŠØ¯: Ø¯Ø¹Ù… Ù…Ø±Ø¦ÙŠØ§Øª */
      }

      /* --- Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† (Dark Mode) --- */
      body.dark-mode {
        --bg-color: #121212;
        --panel-bg: #1e1e1e;
        --border-color: #333333;
        --text-color: #e0e0e0;
        --light-text: #b0b0b0;
        --hover-bg: #2a2a2a;
        --shadow-elevation: 0 4px 12px rgba(0, 0, 0, 0.4);
      }
      body.dark-mode #file-filter,
      body.dark-mode #search-input {
        background-color: var(--hover-bg);
        border-color: #444;
        color: var(--text-color);
      }

      /* --- Ù…ÙØªØ§Ø­ Ø§Ù„Ø­Ø±ÙƒØ© (Bounce) Ù„Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± --- */
      @keyframes bounce {
        0%,
        20%,
        50%,
        80%,
        100% {
          transform: translateY(0);
        }
        40% {
          transform: translateY(5px);
        }
        60% {
          transform: translateY(2px);
        }
      }

      body {
        font-family: "Cairo", sans-serif;
        margin: 0;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        height: 100vh;
        overflow: hidden;
        transition: background-color 0.3s, color 0.3s;
      }
      .container {
        display: flex;
        width: 100%;
        height: 100%;
      }
      .sidebar {
        width: 380px;
        min-width: 320px;
        background-color: var(--panel-bg);
        border-left: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
        box-shadow: var(--shadow-elevation);
        transition: width 0.3s ease, background-color 0.3s;
      }
      .sidebar-header {
        padding: 20px 25px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        flex-direction: column;
      }
      .sidebar-header .top-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
      }
      .sidebar-header h3 {
        margin: 0;
        font-size: 1.6em;
        font-weight: 700;
        color: var(--text-color);
      }
      #file-filter,
      #search-input {
        width: 100%;
        padding: 12px 15px;
        border-radius: 8px;
        border: 1px solid var(--border-color);
        font-family: "Cairo", sans-serif;
        font-size: 1em;
        box-sizing: border-box;
        transition: border-color 0.2s, box-shadow 0.2s, background-color 0.3s,
          color 0.3s;
        background-color: var(--hover-bg);
        color: var(--text-color);
      }
      #search-input {
        margin-top: 10px;
      }
      #file-filter:focus,
      #search-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        background-color: var(--panel-bg);
      }

      .table-container {
        overflow-y: auto;
        flex-grow: 1;
        padding: 0 15px;
        position: relative;
      }
      
      /* --- ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø´Ø¬Ø±ÙŠØ© (Tree View) --- */
      #file-list {
        list-style: none;
        padding: 10px 0;
        margin: 0;
      }
      #file-list .file-item,
      #file-list .folder-item {
        margin: 4px 0;
        padding: 10px 15px;
        cursor: pointer;
        border-radius: 8px;
        transition: background-color 0.2s ease;
        display: flex;
        align-items: center;
        justify-content: space-between;
        color: var(--text-color);
      }
      #file-list .file-item:hover,
      #file-list .folder-item-content:hover {
        background-color: var(--hover-bg);
      }
      #file-list .file-item.active {
        background-color: var(--primary-color);
        color: white;
      }
      #file-list .file-item.active .icon-type {
        color: white !important;
      }
      #file-list .file-item-content {
        display: flex;
        align-items: center;
        flex-grow: 1;
        min-width: 0;
      }
      #file-list .file-name {
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-size: 1em;
        font-weight: 400;
        flex-grow: 1;
      }
      #file-list .icon-type {
        font-size: 1.4em;
        margin-left: 10px;
        transition: color 0.2s;
        width: 25px;
        text-align: center;
      }
      /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª */
      .folder-item {
        font-weight: 600;
        background-color: transparent !important;
        padding-left: 0;
        padding-right: 0;
        margin-top: 8px;
        margin-bottom: 8px;
      }
      .folder-item-content {
        display: flex;
        align-items: center;
        width: 100%;
        padding: 10px 15px;
        transition: background-color 0.2s ease;
        border-radius: 8px;
      }
      .folder-toggle-icon {
        margin-left: 10px;
        transition: transform 0.3s;
        font-size: 0.8em;
      }
      .folder-item.collapsed .folder-toggle-icon {
        transform: rotate(-90deg);
      }
      .folder-content {
        list-style: none;
        padding: 0;
        margin: 0;
        padding-right: 20px;
        overflow: hidden;
        transition: max-height 0.3s ease-out;
      }
      .folder-item.collapsed + .folder-content {
        max-height: 0 !important;
      }
      .folder-item-content .icon-type {
        font-size: 1.2em;
        color: #ffc107;
      }
      /* ---------------------------------------------------- */

      /* --- ØªÙ†Ø³ÙŠÙ‚ Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± --- */
      .scroll-indicator {
        text-align: center;
        padding: 5px 0 10px 0;
        color: var(--primary-color);
        background-color: var(--panel-bg);
        border-top: 1px solid var(--border-color);
        cursor: pointer;
        transition: opacity 0.3s ease, background-color 0.3s;
        position: relative;
        z-index: 10;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.03);
      }
      body.dark-mode .scroll-indicator {
        box-shadow: 0 -2px 5px rgba(255, 255, 255, 0.05);
      }
      .scroll-indicator i {
        animation: bounce 2s infinite;
      }
      /* ------------------------------------ */


      .main-content {
        flex-grow: 1;
        padding: 30px;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }
      .viewer-controls {
        margin-bottom: 20px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }
      .header-info {
        display: flex;
        align-items: baseline;
        flex-wrap: wrap;
        flex-grow: 1;
      }
      .viewer-controls h2 {
        margin: 0 10px 0 0;
        font-size: 1.5em;
        font-weight: 600;
        color: var(--text-color);
      }
      .programmer-credit {
        font-size: 1em;
        font-weight: 400;
        color: var(--light-text);
        white-space: nowrap;
      }
      .action-buttons {
        display: flex;
        gap: 10px;
        margin-right: 15px;
      }
      .action-buttons button,
      #download-btn {
        display: none;
        align-items: center;
        justify-content: center;
        padding: 10px 20px;
        background-color: var(--primary-color);
        color: white;
        text-decoration: none;
        border-radius: 25px;
        font-size: 1em;
        font-weight: 600;
        transition: background-color 0.3s ease, transform 0.2s ease,
          box-shadow 0.3s ease;
        box-shadow: 0 4px 10px rgba(0, 123, 255, 0.2);
        border: none;
        cursor: pointer;
      }
      .action-buttons button:hover,
      #download-btn:hover {
        background-color: var(--secondary-color);
        box-shadow: 0 6px 15px rgba(0, 123, 255, 0.3);
        transform: translateY(-1px);
      }
      .action-buttons i,
      #download-btn i {
        margin-left: 10px;
        font-size: 1.1em;
      }
      /* ØªÙ†Ø³ÙŠÙ‚ Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· */
      #copy-link-btn {
        width: 40px;
        padding: 0;
        background: none;
        color: var(--primary-color);
        box-shadow: none;
      }
      #copy-link-btn i {
        margin: 0;
        font-size: 1.3em;
      }
      #copy-link-btn:hover {
        background: var(--hover-bg);
        transform: none;
        box-shadow: none;
      }
      /* ØªÙ†Ø³ÙŠÙ‚ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØµØºÙŠØ± */
      .zoom-buttons {
        display: none; /* ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ Ø¹Ø¨Ø± JS */
        align-items: center;
        gap: 5px;
        margin-left: 10px;
      }
      .zoom-buttons button {
        width: 35px;
        height: 35px;
        padding: 0;
        background: var(--panel-bg);
        color: var(--text-color);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        border-radius: 5px;
        font-size: 1.2em;
        border: 1px solid var(--border-color);
      }
      .zoom-buttons button:hover {
        background: var(--hover-bg);
        transform: none;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
      }

      /* Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† */
      #dark-mode-toggle {
        width: 40px;
        height: 40px;
        padding: 0;
        background: none;
        color: var(--text-color);
        box-shadow: none;
        border: 1px solid var(--border-color);
        border-radius: 50%;
        margin-right: 10px;
      }
      #dark-mode-toggle i {
        margin: 0;
        color: var(--text-color);
      }
      #dark-mode-toggle:hover {
        background: var(--hover-bg);
        transform: none;
        box-shadow: none;
      }

      #viewer {
        flex-grow: 1;
        background: var(--panel-bg);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        box-shadow: var(--shadow-elevation);
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        transition: background-color 0.3s, border-color 0.3s;
      }
      #viewer iframe {
        width: 100%;
        height: 100%;
        border: none;
        background-color: var(--panel-bg);
        transform-origin: center center;
        transition: transform 0.2s ease;
      }
      .viewer-content {
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: auto; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¨Ø¹Ø¯ Ø§Ù„ØªÙƒØ¨ÙŠØ± */
        transition: transform 0.2s ease;
      }
      #viewer img,
      #viewer audio,
      #viewer video {
        max-width: 100%;
        max-height: 100%;
        object-fit: contain;
        border-radius: 10px;
        transform-origin: center center;
        transition: transform 0.2s ease;
      }
      #viewer audio,
      #viewer video {
        margin: 20px;
        width: auto;
        max-width: 90%;
        height: auto;
      }
      .loader-message {
        font-size: 1.3em;
        color: var(--light-text);
        font-weight: 400;
        text-align: center;
        padding: 20px;
      }
      .footer {
        display: none;
      }

      @media (max-width: 768px) {
        .container {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          height: 50%;
          min-height: 250px;
          border-left: none;
          border-bottom: 1px solid var(--border-color);
        }
        .main-content {
          padding: 20px;
          flex-grow: 1;
        }
        .viewer-controls {
          flex-direction: column;
          align-items: flex-start;
        }
        .header-info {
          flex-direction: column;
          align-items: flex-start;
          margin-bottom: 10px;
        }
        .action-buttons {
          margin-top: 10px;
          margin-right: 0;
          width: 100%;
          justify-content: flex-start;
        }
        #download-btn {
          flex-grow: 1;
        }
        .zoom-buttons {
          margin-left: 0;
          margin-right: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <aside class="sidebar">
        <div class="sidebar-header">
          <div class="top-row">
            <h3>ğŸ“‚ ÙÙ‡Ø±Ø³ Ø§Ù„Ù…Ù„ÙØ§Øª</h3>
            <button id="dark-mode-toggle" title="Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† / Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­">
              <i class="fa-solid fa-moon"></i>
            </button>
          </div>
          <select id="file-filter">
            <option value="all">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</option>
            <option value="pdf">Ù…Ù„ÙØ§Øª PDF</option>
            <option value="doc">Ù…Ø³ØªÙ†Ø¯Ø§Øª Word</option>
            <option value="xls">Ø¬Ø¯Ø§ÙˆÙ„ Excel</option>
            <option value="ppt">Ø¹Ø±ÙˆØ¶ PowerPoint</option>
            <option value="img">Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØ±</option>
            <option value="audio">Ù…Ù„ÙØ§Øª ØµÙˆØªÙŠØ©</option>
            <option value="video">Ù…Ù„ÙØ§Øª Ù…Ø±Ø¦ÙŠØ©</option>
            <option value="txt">Ù…Ù„ÙØ§Øª Ù†ØµÙŠØ©</option>
            <option value="html">Ù…Ù„ÙØ§Øª HTML</option>
            <option value="other">Ù…Ù„ÙØ§Øª Ø£Ø®Ø±Ù‰</option>
          </select>
          <input
            type="text"
            id="search-input"
            placeholder="ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù..."
          />
        </div>
        <div class="table-container">
          <ul id="file-list"></ul>
        </div>
        <div id="scroll-indicator" class="scroll-indicator" style="display: none;" title="Ù…Ø±Ø± Ù„Ù„Ø£Ø³ÙÙ„ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø²ÙŠØ¯">
            <i class="fa-solid fa-angles-down"></i>
        </div>
      </aside>
      <main class="main-content">
        <div class="viewer-controls">
          <div class="header-info">
            <h2>Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©</h2>
            <span class="programmer-credit">Ø¨Ø±Ù…Ø¬Ø© Ø§Ù„Ø£Ø³ØªØ§Ø°: Ù†ÙØ§Ù„ Ù…Ø±Ø²ÙˆÙ‚</span>
          </div>
          <div class="action-buttons">
            <div class="zoom-buttons">
              <button id="zoom-in" title="ØªÙƒØ¨ÙŠØ±"><i class="fa-solid fa-plus"></i></button>
              <button id="zoom-out" title="ØªØµØºÙŠØ±"><i class="fa-solid fa-minus"></i></button>
            </div>
            <button id="copy-link-btn" title="Ù†Ø³Ø® Ø±Ø§Ø¨Ø· Ø§Ù„Ù…Ù„Ù">
              <i class="fa-solid fa-link"></i>
            </button>
            <a href="#" id="download-btn" download
              >ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù<i class="fa-solid fa-download"></i
            ></a>
          </div>
        </div>
        <div id="viewer">
          <div class="loader-message">
            Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù…Ù† Ø§Ù„ÙÙ‡Ø±Ø³ Ù„Ø¹Ø±Ø¶Ù‡
            <br />
            (ÙŠØ¹Ù…Ù„ Ø¹Ù„Ù‰ Ø¨ÙŠØ¦Ø© GitHub Pages ÙÙ‚Ø·)
          </div>
        </div>
        <footer class="footer">
          </footer>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const fileListElement = document.getElementById("file-list");
        const viewerElement = document.getElementById("viewer");
        const downloadBtn = document.getElementById("download-btn");
        const copyLinkBtn = document.getElementById("copy-link-btn");
        const filterElement = document.getElementById("file-filter");
        const searchElement = document.getElementById("search-input");
        const darkModeToggle = document.getElementById("dark-mode-toggle");
        const zoomInBtn = document.getElementById("zoom-in");
        const zoomOutBtn = document.getElementById("zoom-out");
        const zoomButtons = document.querySelector(".zoom-buttons");
        const tableContainer = document.querySelector(".table-container");
        const scrollIndicator = document.getElementById("scroll-indicator");


        const defaultFile = "ØªØ¹Ù„ÙŠÙ…Ø§Øª.pdf";
        let currentActiveFile = null;
        let fileStructure = {};
        let currentZoomLevel = 1.0;
        const ZOOM_STEP = 0.1;
        const MAX_ZOOM = 2.0;
        const MIN_ZOOM = 0.5;

        // --- 1. ÙˆØ¸Ø§Ø¦Ù Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ ÙˆØ£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ù…Ù„Ù ---

        function getFileType(filename) {
          const extension = filename.split(".").pop().toLowerCase();
          if (extension === "pdf") return "pdf";
          if (["doc", "docx"].includes(extension)) return "doc";
          if (["xls", "xlsx"].includes(extension)) return "xls";
          if (["ppt", "pptx"].includes(extension)) return "ppt";
          if (
            ["png", "jpg", "jpeg", "gif", "svg", "webp", "bmp"].includes(
              extension
            )
          )
            return "img";
          if (["mp3", "wav", "ogg"].includes(extension)) return "audio"; // Ø¯Ø¹Ù… ØµÙˆØªÙŠØ§Øª
          if (["mp4", "webm", "ogg"].includes(extension)) return "video"; // Ø¯Ø¹Ù… Ù…Ø±Ø¦ÙŠØ§Øª
          if (extension === "txt") return "txt";
          if (["html", "htm"].includes(extension)) return "html";
          return "other";
        }

        function getFileIconClass(filename) {
          const extension = filename.split(".").pop().toLowerCase();
          const solid = "fa-solid ";
          if (extension === "pdf") return solid + "fa-file-pdf";
          if (["doc", "docx"].includes(extension))
            return solid + "fa-file-word";
          if (["xls", "xlsx"].includes(extension))
            return solid + "fa-file-excel";
          if (["ppt", "pptx"].includes(extension))
            return solid + "fa-file-powerpoint";
          if (
            ["png", "jpg", "jpeg", "gif", "svg", "webp", "bmp"].includes(
              extension
            )
          )
            return solid + "fa-file-image";
          if (["mp3", "wav"].includes(extension)) return solid + "fa-file-audio"; // Ø£ÙŠÙ‚ÙˆÙ†Ø© ØµÙˆØª
          if (["mp4", "webm"].includes(extension)) return solid + "fa-file-video"; // Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙŠØ¯ÙŠÙˆ
          if (extension === "txt") return solid + "fa-file-lines";
          if (["html", "htm"].includes(extension))
            return solid + "fa-file-code";
          return solid + "fa-file";
        }

        // --- 2. Ø¯Ø§Ù„Ø© Ù„Ø¬Ù„Ø¨ ÙˆØ¹Ø±Ø¶ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª (Tree View) ---

        async function fetchAndDisplayFiles() {
          const [username, repo] = [
            window.location.hostname.split(".")[0],
            window.location.pathname.split("/")[1],
          ];

          if (!window.location.hostname.includes("github.io")) {
            viewerElement.innerHTML = `<div class="loader-message" style="color: #e74c3c;">Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø§Ø±Ø¶ Ù…ØµÙ…Ù… Ù„Ù„Ø¹Ù…Ù„ Ø¹Ù„Ù‰ Ù…ÙˆØ§Ù‚Ø¹ GitHub Pages ÙÙ‚Ø·.</div>`;
            return;
          }

          // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù€ API Ø§Ù„Ù…ØªÙƒØ±Ø±Ø© (Recursive) Ù„Ø¬Ù„Ø¨ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª
          const apiUrl = `https://api.github.com/repos/${username}/${repo}/git/trees/main?recursive=1`;

          try {
            const response = await fetch(apiUrl);
            if (!response.ok) {
              const errorText = await response.text();
              throw new Error(
                `ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨ÙˆØ§Ø¬Ù‡Ø© GitHub API. (HTTP ${response.status} - ${errorText.substring(
                  0,
                  100
                )}...)`
              );
            }
            const data = await response.json();

            fileStructure = buildTree(data.tree);
            // Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¹Ø±Ø¶ Ù…Ù† Ù…Ø¬Ù„Ø¯ 'documents'
            renderTree(fileStructure.documents || {}, fileListElement);

            filterElement.addEventListener("change", searchAndFilterFiles);
            searchElement.addEventListener("input", searchAndFilterFiles);

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
            const defaultFileElement = document.querySelector(
              `[data-path$="${defaultFile}"]`
            );
            if (defaultFileElement) {
              defaultFileElement.click();
              // ØªÙˆØ³ÙŠØ¹ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
              let parentFolder = defaultFileElement.closest(".folder-content");
              while (parentFolder) {
                const folderItem = parentFolder.previousElementSibling;
                if (folderItem && folderItem.classList.contains("folder-item")) {
                  folderItem.classList.remove("collapsed");
                  folderItem.nextElementSibling.style.maxHeight = folderItem.nextElementSibling.scrollHeight + 'px';
                }
                parentFolder = parentFolder.parentElement.closest(
                  ".folder-content"
                );
              }
            } else {
              viewerElement.innerHTML = `<div class="loader-message">ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨Ù†ÙŠØ© Ø§Ù„Ù…Ù„ÙØ§Øª. Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù.</div>`;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„ÙØ§Øª
            updateScrollIndicator();
          } catch (error) {
            viewerElement.innerHTML = `<div class="loader-message" style="color: #e74c3c;">ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª: <br>${error.message}</div>`;
          }
        }

        /** ØªØ­ÙˆÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù„ÙØ§Øª Ø§Ù„Ù…Ø³Ø·Ø­Ø© Ø¥Ù„Ù‰ Ø¨Ù†ÙŠØ© Ø´Ø¬Ø±ÙŠØ© Ù…ØªØ¯Ø§Ø®Ù„Ø© */
        function buildTree(tree) {
          const root = {};
          tree.forEach((item) => {
            if (!item.path.startsWith("documents/") && item.path !== "documents")
              return;

            const parts = item.path.split("/");
            let temp = root;
            for (let i = 0; i < parts.length; i++) {
              const part = parts[i];
              if (!temp[part]) {
                temp[part] = {
                  children: {},
                  type: item.type === "tree" ? "folder" : "file",
                  path: item.path,
                };
              }
              if (i < parts.length - 1) {
                temp = temp[part].children;
              }
            }
          });
          return root;
        }

        /** Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ù†ÙŠØ© Ø§Ù„Ø´Ø¬Ø±ÙŠØ© ÙÙŠ Ø§Ù„Ù€ HTML */
        function renderTree(node, parentElement) {
          const sortedKeys = Object.keys(node).sort((a, b) => {
            const isAFolder = node[a].type === "folder";
            const isBFolder = node[b].type === "folder";
            if (isAFolder && !isBFolder) return -1; // Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø£ÙˆÙ„Ø§Ù‹
            if (!isAFolder && isBFolder) return 1;
            return a.localeCompare(b, "ar"); // Ø«Ù… Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø¨Ø¬Ø¯ÙŠ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
          });

          sortedKeys.forEach((key) => {
            const item = node[key];
            const displayName = key.replace(/\.[^/.]+$/, "");

            if (item.type === "folder") {
              const folderLi = document.createElement("li");
              folderLi.className = "folder-item collapsed";
              folderLi.dataset.path = item.path;

              const folderContentDiv = document.createElement("div");
              folderContentDiv.className = "folder-item-content";
              folderContentDiv.addEventListener("click", () => {
                const isCollapsed = folderLi.classList.toggle("collapsed");
                const contentUl = folderLi.nextElementSibling;
                if (
                  contentUl &&
                  contentUl.classList.contains("folder-content")
                ) {
                  // Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ù„ØªØ£Ø«ÙŠØ± Ø§Ù„Ø§Ù†Ø¨Ø«Ø§Ù‚
                  contentUl.style.maxHeight = isCollapsed
                    ? "0"
                    : contentUl.scrollHeight + "px";
                }
                setTimeout(updateScrollIndicator, 350); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø­Ø±ÙƒØ©
              });

              folderContentDiv.innerHTML = `
                        <i class="fa-solid fa-caret-down folder-toggle-icon"></i>
                        <i class="fa-solid fa-folder icon-type"></i>
                        <span class="file-name">${displayName}</span>
                    `;
              folderLi.appendChild(folderContentDiv);
              parentElement.appendChild(folderLi);

              const folderUl = document.createElement("ul");
              folderUl.className = "folder-content";
              parentElement.appendChild(folderUl);

              renderTree(item.children, folderUl);
            } else if (item.type === "file") {
              const fileLi = document.createElement("li");
              fileLi.className = "file-item";
              fileLi.dataset.path = item.path;
              fileLi.dataset.filetype = getFileType(item.path);

              fileLi.innerHTML = `
                        <div class="file-item-content">
                            <i class="${getFileIconClass(
                              item.path
                            )} icon-type" style="color: var(--icon-color-${getFileType(
                item.path
              )}); margin-right: 0;"></i>
                            <span class="file-name">${displayName}</span>
                        </div>
                    `;

              fileLi.addEventListener("click", () =>
                displayFile(item.path, fileLi)
              );
              parentElement.appendChild(fileLi);
            }
          });
          // Ø¶Ø¨Ø· Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…ÙØªÙˆØ­Ø© (Ù„Ù„Ø­Ø±ÙƒØ©)
          if (
            parentElement.classList.contains("folder-content") &&
            !parentElement.previousElementSibling.classList.contains("collapsed")
          ) {
            parentElement.style.maxHeight = parentElement.scrollHeight + "px";
          }
        }

        /** Ø¯Ø§Ù„Ø© ØªØµÙÙŠØ© Ø§Ù„Ø´Ø¬Ø±Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ ÙˆØ§Ù„Ø¨Ø­Ø« */
        function filterTree(node, selectedType, searchTerm) {
          const filteredNode = {};
          for (const key in node) {
            const item = node[key];

            if (item.type === "folder") {
              const filteredChildren = filterTree(
                item.children,
                selectedType,
                searchTerm
              );
              // Ø¥Ø¨Ù‚Ø§Ø¡ Ø§Ù„Ù…Ø¬Ù„Ø¯ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…Ø·Ø§Ø¨Ù‚Ø§Ù‹ Ù„Ù„Ø¨Ø­Ø« Ø£Ùˆ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ù„ÙØ§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©
              if (
                Object.keys(filteredChildren).length > 0 ||
                key.toLowerCase().includes(searchTerm)
              ) {
                filteredNode[key] = { ...item, children: filteredChildren };
              }
            } else if (item.type === "file") {
              const fileName = item.path.split("/").pop().toLowerCase();
              const fileType = getFileType(fileName);
              const typeMatch =
                selectedType === "all" || fileType === selectedType;
              const searchMatch = fileName.includes(searchTerm);

              if (typeMatch && searchMatch) {
                filteredNode[key] = item;
              }
            }
          }
          return filteredNode;
        }

        // --- 3. ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ© (ØªØ³ØªØ®Ø¯Ù… ÙˆØ¸ÙŠÙØ© filterTree) ---
        function searchAndFilterFiles() {
          const selectedType = filterElement.value;
          const searchTerm = searchElement.value.toLowerCase();
          
          fileListElement.innerHTML = "";
          const filteredRoot = filterTree(
            fileStructure.documents || {},
            selectedType,
            searchTerm
          );
          renderTree(filteredRoot, fileListElement);

          // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ù„Ù Ù†Ø´Ø·ØŒ ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ø¯ÙŠØ¯Ù‡
          if (currentActiveFile) {
            const activeEl = document.querySelector(
              `[data-path="${currentActiveFile}"]`
            );
            if (activeEl) activeEl.classList.add("active");
          }
          
          // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¤Ø´Ø± Ø¨Ø¹Ø¯ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„ØªØµÙÙŠØ©
          updateScrollIndicator();
        }

        // --- 4. ÙˆØ¸ÙŠÙØ© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ ---

        function displayFile(filePath, activeListItem) {
          document
            .querySelectorAll("#file-list .file-item")
            .forEach((item) => item.classList.remove("active"));

          activeListItem.classList.add("active");
          currentActiveFile = filePath;
          currentZoomLevel = 1.0; // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„ØªÙƒØ¨ÙŠØ± Ø¹Ù†Ø¯ ÙØªØ­ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯

          viewerElement.innerHTML = `<div class="loader-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...</div>`;
          const fileExtension = filePath.split(".").pop().toLowerCase();
          // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ù†Ø³Ø¨ÙŠ Ù„Ù„Ù…Ù„Ù (Ø§Ù„Ù…Ø¬Ù„Ø¯ Documents)
          const fileUrlForDownload = `${window.location.protocol}//${window.location.host}${window.location.pathname.replace('index.html', '')}${filePath}`;
          let viewerContent;
          let supportsZoom = false;

          const [username, repo] = [
            window.location.hostname.split(".")[0],
            window.location.pathname.split("/")[1],
          ];
          // Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø®Ø§Ù… Ù„Ù„Ø±Ø¨Ø· Ø¨Ù€ Office Live Viewer
          const rawFileUrl = `https://raw.githubusercontent.com/${username}/${repo}/main/${filePath}`;

          if (
            fileExtension === "pdf" ||
            ["html", "htm", "txt"].includes(fileExtension)
          ) {
            viewerContent = `<div class="viewer-content"><iframe src="${fileUrlForDownload}" class="zoomable"></iframe></div>`;
            supportsZoom = true;
          } else if (
            ["png", "jpg", "jpeg", "gif", "svg", "webp", "bmp"].includes(
              fileExtension
            )
          ) {
            viewerContent = `<div class="viewer-content"><img src="${fileUrlForDownload}" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ${filePath}" class="zoomable"></div>`;
            supportsZoom = true;
          } else if (["mp3", "wav"].includes(fileExtension)) {
            // Ø¯Ø¹Ù… Ù…Ù„ÙØ§Øª Ø§Ù„ØµÙˆØª
            viewerContent = `<div class="viewer-content"><audio controls src="${fileUrlForDownload}"></audio></div>`;
          } else if (["mp4", "webm"].includes(fileExtension)) {
            // Ø¯Ø¹Ù… Ù…Ù„ÙØ§Øª Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
            viewerContent = `<div class="viewer-content"><video controls src="${fileUrlForDownload}"></video></div>`;
          } else if (
            [
              "docx",
              "pptx",
              "xlsx",
              "doc",
              "ppt",
              "xls",
              "dotx",
              "dotm",
              "potx",
              "potm",
              "xltx",
              "xltm",
            ].includes(fileExtension)
          ) {
            // Ø¹Ø§Ø±Ø¶ Office Live
            const viewerUrl = `https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(
              rawFileUrl
            )}`;
            viewerContent = `<div class="viewer-content"><iframe src="${viewerUrl}"></iframe></div>`;
          } else {
            viewerContent = `<div class="loader-message">Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù Ù‡Ø°Ø§ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ… Ù„Ù„Ù…Ø¹Ù€Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø©.<br>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„.</div>`;
          }

          viewerElement.innerHTML = viewerContent;

          // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
          downloadBtn.href = fileUrlForDownload;
          downloadBtn.style.display = "inline-flex";
          copyLinkBtn.style.display = "inline-flex";
          zoomButtons.style.display = supportsZoom ? "flex" : "none";
        }

        // --- 5. ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø§Ù„ØªÙƒØ¨ÙŠØ± ÙˆØ§Ù„ØªØµØºÙŠØ± ---

        function applyZoom() {
          // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù†ØµØ± Ø§Ù„Ø°ÙŠ ÙŠÙ…ÙƒÙ† ØªÙƒØ¨ÙŠØ±Ù‡ (ØµÙˆØ±Ø© Ø£Ùˆ iframe Ù„Ù€ PDF/TXT)
          const zoomElement = viewerElement.querySelector(
            ".viewer-content > .zoomable"
          );
          if (zoomElement) {
            zoomElement.style.transform = `scale(${currentZoomLevel})`;
          }
        }

        zoomInBtn.addEventListener("click", () => {
          if (currentZoomLevel < MAX_ZOOM) {
            currentZoomLevel = Math.min(MAX_ZOOM, currentZoomLevel + ZOOM_STEP);
            applyZoom();
          }
        });

        zoomOutBtn.addEventListener("click", () => {
          if (currentZoomLevel > MIN_ZOOM) {
            currentZoomLevel = Math.max(MIN_ZOOM, currentZoomLevel - ZOOM_STEP);
            applyZoom();
          }
        });

        // --- 6. ÙˆØ¸ÙŠÙØ© Ù…Ø¤Ø´Ø± Ø§Ù„ØªÙ…Ø±ÙŠØ± ---
        function updateScrollIndicator() {
          const isScrollable =
            tableContainer.scrollHeight > tableContainer.clientHeight;
          // Ù†Ø·Ø§Ù‚ ØªÙØ§ÙˆØª 5 Ø¨ÙƒØ³Ù„ Ù„Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¹
          const isAtBottom =
            tableContainer.scrollTop + tableContainer.clientHeight >=
            tableContainer.scrollHeight - 5;

          if (isScrollable && !isAtBottom) {
            scrollIndicator.style.display = "block";
          } else {
            scrollIndicator.style.display = "none";
          }
        }

        tableContainer.addEventListener("scroll", updateScrollIndicator);


        // --- 7. ÙˆØ¸ÙŠÙØ© Ù†Ø³Ø® Ø§Ù„Ø±Ø§Ø¨Ø· ---

        copyLinkBtn.addEventListener("click", () => {
          if (currentActiveFile) {
            // ØªØ¶Ù…ÙŠÙ† Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù ÙÙŠ Ø±Ø§Ø¨Ø· URL Ù„ØªÙ…ÙƒÙŠÙ† Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© (Deep Linking)
            const fileUrlForShare = `${window.location.protocol}//${window.location.host}${window.location.pathname}?file=${currentActiveFile}`;
            navigator.clipboard.writeText(fileUrlForShare).then(() => {
              const originalIcon = copyLinkBtn.innerHTML;
              copyLinkBtn.innerHTML = '<i class="fa-solid fa-check"></i>';
              setTimeout(() => {
                copyLinkBtn.innerHTML = originalIcon;
              }, 1500);
            });
          }
        });

        // --- 8. ÙˆØ¸ÙŠÙØ© Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ---

        function initDarkMode() {
          const isDark =
            localStorage.getItem("dark-mode") === "true" ||
            (window.matchMedia &&
              window.matchMedia("(prefers-color-scheme: dark)").matches);
          if (isDark) {
            document.body.classList.add("dark-mode");
            darkModeToggle.innerHTML = '<i class="fa-solid fa-sun"></i>';
          } else {
            document.body.classList.remove("dark-mode");
            darkModeToggle.innerHTML = '<i class="fa-solid fa-moon"></i>';
          }
        }

        darkModeToggle.addEventListener("click", () => {
          document.body.classList.toggle("dark-mode");
          const isDark = document.body.classList.contains("dark-mode");
          localStorage.setItem("dark-mode", isDark);
          darkModeToggle.innerHTML = isDark
            ? '<i class="fa-solid fa-sun"></i>'
            : '<i class="fa-solid fa-moon"></i>';
        });

        // --- 9. ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ---
        initDarkMode();
        fetchAndDisplayFiles();
      });
    </script>
  </body>
</html>
