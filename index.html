<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Ù…Ø³ØªØ¹Ø±Ø¶ Ù…Ø³ØªÙ†Ø¯Ø§Øª Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@400;700;800&display=swap" rel="stylesheet" />

    <style>
      :root {
        --gold: #d4a853;
        --navy: #0a1628;
        --navy-light: #152238;
        --bg-color: #f4f7f6;
        --panel-bg: #ffffff;
        --text-color: #0a1628;
        --border-radius: 12px;
      }

      * { box-sizing: border-box; margin: 0; padding: 0; }

      body {
        font-family: 'Almarai', sans-serif;
        background-color: var(--bg-color);
        color: var(--text-color);
        display: flex;
        flex-direction: column;
        height: 100vh; /* ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø·ÙˆÙ„ Ø¨ÙƒØ§Ù…Ù„ Ø§Ù„Ø´Ø§Ø´Ø© */
        overflow: hidden; /* Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± ÙÙŠ Ø§Ù„Ø¬Ø³Ù… Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
      }

      .announcement-bar {
        background-color: #d32f2f;
        color: white;
        text-align: center;
        padding: 8px 15px;
        font-size: 0.9rem;
        font-weight: bold;
        z-index: 1001;
      }

      header {
        background: linear-gradient(135deg, var(--navy) 0%, var(--navy-light) 100%);
        color: var(--gold);
        padding: 15px;
        text-align: center;
        border-bottom: 4px solid var(--gold);
        flex-shrink: 0;
      }

      header h1 { font-size: 1.2rem; margin-bottom: 2px; }

      .main-wrapper {
        display: flex;
        flex: 1;
        gap: 15px;
        padding: 15px;
        max-width: 1600px;
        margin: 0 auto;
        width: 100%;
        overflow: hidden; /* Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø®Ø§Ø±Ø¬ÙŠ */
      }

      .sidebar {
        width: 320px;
        background: var(--panel-bg);
        border-radius: var(--border-radius);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        height: 100%;
      }

      .sidebar-header {
        background: var(--navy);
        color: var(--gold);
        padding: 15px;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        font-weight: bold;
      }

      .search-box { padding: 10px; background: #f8f9fa; border-bottom: 1px solid #eee; }
      #search-input {
        width: 100%;
        padding: 10px;
        border: 2px solid #eee;
        border-radius: 8px;
        outline: none;
        transition: 0.3s;
      }
      #search-input:focus { border-color: var(--gold); }

      .file-list-container {
        overflow-y: auto;
        padding: 10px;
        flex: 1;
      }

      .folder-item {
        background: #fdfdfd;
        margin-bottom: 5px;
        cursor: pointer;
        padding: 12px;
        border-radius: 8px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border: 1px solid #eee;
        transition: 0.3s;
      }
      .folder-item:hover { background: #f1f1f1; }

      .file-item {
        padding: 10px 20px;
        cursor: pointer;
        border-bottom: 1px solid #f9f9f9;
        display: none; 
        transition: 0.2s;
        font-size: 0.85rem;
        color: #444;
      }
      .file-item:hover { background: #fff9eb; color: var(--gold); }
      .file-item.active { background: var(--gold); color: var(--navy); font-weight: bold; border-radius: 5px; }

      /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ - ØªØ­Ø³ÙŠÙ† Ø§Ù„Ø¬ÙˆØ§Ù„ */
      .viewer-area {
        flex: 1;
        background: var(--panel-bg);
        border-radius: var(--border-radius);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .viewer-toolbar {
        padding: 12px 15px;
        border-bottom: 2px solid var(--gold);
        display: flex;
        justify-content: space-between;
        align-items: center;
        background: #fafafa;
        flex-shrink: 0;
      }

      #display-container {
        flex: 1;
        width: 100%;
        height: 100%;
        position: relative;
        background: #525659; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø§Ù„Ù‚Ø§Ø±Ø¦ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ */
      }

      #viewer-frame {
        width: 100%;
        height: 100%;
        border: none;
        display: block;
      }

      .btn-download {
        background: var(--gold);
        color: var(--navy);
        padding: 8px 15px;
        text-decoration: none;
        border-radius: 6px;
        font-weight: bold;
        font-size: 0.8rem;
        display: flex;
        align-items: center;
        gap: 5px;
      }

      /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬ÙˆØ§Ù„ */
      @media (max-width: 992px) {
        body { overflow: auto; height: auto; }
        .main-wrapper { flex-direction: column; height: auto; overflow: visible; }
        .sidebar { width: 100%; height: 400px; }
        .viewer-area { height: 80vh; min-height: 500px; margin-bottom: 20px; }
        header h1 { font-size: 1.1rem; }
      }
    </style>
  </head>
  <body>

    <div class="announcement-bar">
      ğŸ“¢ Ø¨Ø§Ù„ØªÙˆÙÙŠÙ‚ Ù„Ø·Ù„Ø§Ø¨Ù†Ø§ ÙÙŠ Ø§Ø®ØªØ¨Ø§Ø±Ø§ØªÙ‡Ù…
    </div>

    <header>
      <h1>Ù…Ø¯Ø±Ø³Ø© ØªØ­ÙÙŠØ¸ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø¨Ø§Ù„Ø¨Ø¬Ø§Ø¯ÙŠØ©</h1>
      <p style="font-size: 0.8rem; opacity: 0.8;">Ø¨ÙˆØ§Ø¨Ø© Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ©</p>
    </header>

    <div class="main-wrapper">
      <aside class="sidebar">
        <div class="sidebar-header">
          <i class="fas fa-folder-open"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙØµÙˆÙ„
        </div>
        <div class="search-box">
          <input type="text" id="search-input" placeholder="Ø¨Ø­Ø« Ø¹Ù† Ù…Ù„Ù..." onkeyup="filterFiles()">
        </div>
        <div class="file-list-container" id="file-list">
          </div>
      </aside>

      <main class="viewer-area">
        <div class="viewer-toolbar">
          <div id="file-title" style="font-weight: bold; color: var(--navy); font-size: 0.9rem;">Ø§Ø®ØªØ± Ù…Ù„ÙØ§Ù‹ Ù„Ù„Ø¹Ø±Ø¶</div>
          <a href="#" id="download-link" class="btn-download" style="display: none;" target="_blank">
            <i class="fas fa-download"></i> ØªØ­Ù…ÙŠÙ„
          </a>
        </div>
        <div id="display-container">
            <div id="placeholder" style="display:flex; flex-direction:column; align-items:center; justify-content:center; height:100%; color:#aaa; background:#fff;">
                <i class="fas fa-file-pdf" style="font-size: 4rem; margin-bottom:15px; opacity:0.2;"></i>
                <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ÙŠÙ…Ù†Ù‰</p>
            </div>
        </div>
      </main>
    </div>

    <script>
      const username = "nmoschool";
      const repo = "doc_viewer";
      const folderPath = "documents";
      const classFolders = ["Ø¬Ø¯Ø§ÙˆÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª", "Ø£ÙˆÙ„ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø«Ø§Ù†ÙŠ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø«Ø§Ù„Ø« Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø±Ø§Ø¨Ø¹ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø®Ø§Ù…Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ", "Ø³Ø§Ø¯Ø³ Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"];

      async function init() {
        const listDiv = document.getElementById('file-list');
        listDiv.innerHTML = '<p style="padding:20px; text-align:center;">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù„ÙØ§Øª...</p>';

        let html = '';
        for (const folder of classFolders) {
          try {
            const res = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${folderPath}/${encodeURIComponent(folder)}`);
            const files = await res.json();
            
            if (Array.isArray(files)) {
              html += `<div class="folder-item" onclick="toggleFolder(this)">
                        <span><i class="fas fa-folder"></i> ${folder}</span>
                        <i class="fas fa-chevron-down"></i>
                      </div>
                      <div class="folder-content" style="display:none;">`;
              
              files.forEach(file => {
                html += `<div class="file-item" data-name="${file.name}" onclick="loadFile('${file.name}', '${folder}/${file.name}', this)">
                          <i class="${getIcon(file.name)}"></i> ${file.name.split('.').shift()}
                        </div>`;
              });
              html += `</div>`;
            }
          } catch (e) { console.error("Error loading folder: " + folder); }
        }
        listDiv.innerHTML = html;
      }

      function getIcon(name) {
        const ext = name.split('.').pop().toLowerCase();
        if (ext === 'pdf') return 'fas fa-file-pdf' style='color:#e74c3c';
        if (['doc', 'docx'].includes(ext)) return 'fas fa-file-word' style='color:#2b579a';
        return 'fas fa-file-alt';
      }

      function toggleFolder(el) {
        const content = el.nextElementSibling;
        const icon = el.querySelector('.fa-chevron-down');
        const isOpen = content.style.display === 'block';
        
        content.style.display = isOpen ? 'none' : 'block';
        el.style.color = isOpen ? 'var(--navy)' : 'var(--gold)';
        if(icon) icon.style.transform = isOpen ? 'rotate(0deg)' : 'rotate(180deg)';

        const files = content.querySelectorAll('.file-item');
        files.forEach(f => f.style.display = isOpen ? 'none' : 'block');
      }

      function loadFile(name, path, el) {
        document.querySelectorAll('.file-item').forEach(i => i.classList.remove('active'));
        el.classList.add('active');

        document.getElementById('file-title').innerText = name;
        const container = document.getElementById('display-container');
        const downloadLink = document.getElementById('download-link');
        
        const fullPath = `https://nmoschool.github.io/doc_viewer/documents/${encodeURIComponent(path)}`;
        const ext = name.split('.').pop().toLowerCase();

        downloadLink.href = fullPath;
        downloadLink.style.display = 'flex';

        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

        if (ext === 'pdf') {
          // Ø§Ø³ØªØ®Ø¯Ø§Ù… Google Viewer Ù„Ù„Ø¬ÙˆØ§Ù„ ÙˆØ§Ù„Ù€ iframe Ø§Ù„Ù…Ø¨Ø§Ø´Ø± Ù„Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± Ù…Ø¹ Ø¶Ù…Ø§Ù† Ù…Ù„Ø¡ Ø§Ù„Ø´Ø§Ø´Ø©
          const viewerUrl = isMobile 
            ? `https://docs.google.com/viewer?url=${encodeURIComponent(fullPath)}&embedded=true` 
            : fullPath;
          
          container.innerHTML = `<iframe id="viewer-frame" src="${viewerUrl}"></iframe>`;
        } 
        else if (['doc', 'docx', 'xls', 'xlsx'].includes(ext)) {
          container.innerHTML = `<iframe id="viewer-frame" src="https://view.officeapps.live.com/op/embed.aspx?src=${encodeURIComponent(fullPath)}"></iframe>`;
        } 
        else if (['jpg', 'png', 'jpeg'].includes(ext)) {
          container.innerHTML = `<div style="display:flex; align-items:center; justify-content:center; height:100%; background:#fff; overflow:auto;"><img src="${fullPath}" style="max-width:100%; height:auto;"></div>`;
        }
        
        // ØªÙ…Ø±ÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ø¬ÙˆØ§Ù„
        if (window.innerWidth <= 992) {
            document.querySelector('.viewer-area').scrollIntoView({ behavior: 'smooth' });
        }
      }

      function filterFiles() {
        const term = document.getElementById('search-input').value.toLowerCase();
        const files = document.querySelectorAll('.file-item');
        files.forEach(f => {
          const name = f.getAttribute('data-name').toLowerCase();
          const folderContent = f.parentElement;
          const folderHeader = folderContent.previousElementSibling;

          if(name.includes(term)) {
            f.style.display = 'block';
            folderContent.style.display = 'block';
            folderHeader.style.display = 'flex';
          } else {
            f.style.display = 'none';
          }
        });
      }

      init();
    </script>
  </body>
</html>
